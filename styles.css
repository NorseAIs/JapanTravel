:root{
  --bg:#0b0f1a; --panel:#0a0d16; --muted:#94a3b8; --text:#e5e7eb;
  --accent:#7c3aed; --accent2:#ef4444; --accent3:#1e3a8a; --border:#1f2937;
  --jp-red:#b91c1c; --jp-deep:#7f1d1d; --jp-gold:#eab308; --jp-indigo:#1e3a8a; --jp-rose:#ff8fb1;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;color:var(--text);font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}

/* Dark Japan background */
body.jp-max{
  background:
    radial-gradient(1200px 800px at 10% -10%, #0f172a 0%, transparent 60%),
    radial-gradient(1000px 700px at 120% 30%, #0a1020 0%, transparent 70%),
    linear-gradient(180deg,#0b0f1a,#0a0f1d 60%),
    repeating-linear-gradient(0deg,#0f172a 0 10px,#0e1628 10px 20px);
  background-blend-mode: overlay, overlay, normal, multiply;
}

/* Header */
.mincho{font-family:"Noto Serif JP", serif; letter-spacing:.03em; margin-right:6px}
.hinomaru{display:inline-block;width:14px;height:14px;border-radius:50%;background:var(--jp-red);margin-right:8px;box-shadow:0 0 0 1px #0006 inset}
.divider{display:inline-block;width:1px;height:14px;background:#334155;margin:0 8px;vertical-align:middle}

.app{position:relative; z-index:1; display:grid;grid-template-columns:300px 1fr;grid-template-rows:auto 1fr;min-height:100vh}
header{grid-column:1/-1;display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border);background:rgba(6,10,20,.7);backdrop-filter:blur(6px)}
.title{font-weight:700;color:#fca5a5}
.pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:linear-gradient(180deg,#111827,#0a1222)}
.pill input[type=date]{background:transparent;border:none;color:var(--text)}

aside{border-right:1px solid var(--border);background:rgba(255,255,255,.03)}
.sidebar{padding:12px;display:flex;flex-direction:column;gap:12px}
.section{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:14px}
.section h3{margin:0;padding:8px 10px;border-bottom:1px solid var(--border);font-size:14px;color:#f1f5f9}
.route{padding:6px 8px;display:flex;flex-direction:column;gap:6px}
.route button{width:100%;text-align:left;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:linear-gradient(180deg,#0b1220,#0a0f1d);color:var(--text);cursor:pointer}
.route button:hover{border-color:#334155}
.route button.active{background:linear-gradient(180deg,#b91c1c,#7f1d1d);border-color:#b91c1c;color:#fff;transform:scale(1.03)}
.badge{font-size:11px;color:#fde68a;background:#7c2d12;padding:2px 8px;border-radius:999px;margin-left:6px}
.friend{color:#f59e0b}

main{padding:14px}
.content{display:grid;grid-template-columns:1.1fr .9fr;gap:14px}

/* Cards */
.card{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:0 4px 20px #0007}
.card h3{margin:0;font-size:14px;color:#f8fafc;border-bottom:1px solid var(--border);padding:8px 10px;background:linear-gradient(180deg,#0b1020,#08101f)}
.card h3::before{content:"⛩ "; color:var(--jp-gold)}
.card .inner{padding:10px}

/* Map */
.mapWrap{position:relative;height:520px}
#leafletMap{width:100%;height:100%;border-radius:12px;outline:2px solid #172036;box-shadow:0 2px 18px #0008}
.leaflet-container{background:#0a1020}

/* ema-style tooltip tags — (fixed selector) */
.leaflet-tooltip.city-label{
  background: linear-gradient(180deg,#f8f1d6,#e7d8a1);
  border: 1px solid #7c2d12;
  color: #1f2937;
  padding: 4px 8px;
  border-radius: 4px;
  box-shadow: 0 2px 0 #0004;
  font-weight: 700;
  font-size: 12px;
}
.leaflet-tooltip.city-label:before{
  content:""; position:absolute; left:-6px; top:8px; width:0; height:0;
  border-top:6px solid transparent; border-bottom:6px solid transparent; border-right:6px solid #7c2d12;
}

/* pulse ring for selected city */
.pulse-ring{
  width:22px; height:22px; border-radius:50%;
  border:3px solid var(--jp-red);
  position:absolute; transform:translate(-50%,-50%);
  animation:pulse 900ms ease-out 1;
  pointer-events:none;
}
@keyframes pulse{
  0%{transform:translate(-50%,-50%) scale(.6); opacity:.95}
  100%{transform:translate(-50%,-50%) scale(2.6); opacity:0}
}
.legend{position:absolute;right:10px;bottom:10px;background:rgba(0,0,0,.5);border:1px solid var(--border);padding:6px 8px;border-radius:10px;color:#cbd5e1;font-size:12px}

/* Forms */
.grid.two{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
.grid.two.span2{grid-column:1/-1}
label{font-size:12px;color:#cbd5e1}
input,textarea,select{width:100%;background:linear-gradient(180deg,#0c1222,#0a0e18);color:var(--text);border:1px solid #223049;border-radius:10px;padding:10px}
input::placeholder,textarea::placeholder{color:#8ea0b8}
.bigarea{width:100%;min-height:160px}

/* Tabs */
.tabs{display:flex;gap:8px;border-bottom:1px solid var(--border);padding:8px 8px 0}
.tab{padding:8px 10px;border:1px solid var(--border);border-bottom:none;border-radius:10px 10px 0 0;background:linear-gradient(180deg,#0c1324,#0a101b);cursor:pointer;color:#e2e8f0}
.tab.active{color:#fff;background:linear-gradient(180deg,#1e3a8a,#7c3aed);border-color:transparent}
.tabPanel{padding:10px}

/* Budget table */
.table-clean{width:100%;border-collapse:separate;border-spacing:0}
.table-clean thead th{
  position:sticky; top:0; background:linear-gradient(180deg,#1b2450,#141a34);
  z-index:1; border-bottom:1px solid var(--border); padding:12px 10px; font-weight:800;
  color:#f8fafc; letter-spacing:.02em; font-feature-settings:"tnum" 1,"lnum" 1;
}
.table-clean tbody td{padding:12px 10px;border-bottom:1px solid var(--border);vertical-align:middle; font-feature-settings:"tnum" 1,"lnum" 1;}
.table-clean tbody tr:nth-child(even){background:rgba(255,255,255,.03)}
.table-clean tbody tr:hover{background:rgba(255,255,255,.06)}
.table-clean tfoot td{padding:12px 10px;border-top:1px solid var(--border);font-weight:800;background:linear-gradient(180deg,#10172a,#0c1426)}
.num{text-align:right}
.right{text-align:right}

/* Buttons */
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.btn{padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:linear-gradient(180deg,#0b1220,#0a0f1d);color:var(--text);cursor:pointer;box-shadow:0 2px 0 #0006}
.btn.primary{background:linear-gradient(180deg,#1e3a8a,#7c3aed);border-color:transparent}
.btn.ok{background:linear-gradient(180deg,#16a34a,#065f46);border-color:transparent}
.btn.warn{background:linear-gradient(180deg,#f59e0b,#b45309);border-color:transparent}
.hint{font-size:12px;color:#cbd5e1}
.foot{display:flex;gap:8px;align-items:center;justify-content:flex-end;padding:8px;border-top:1px solid var(--border)}
.list{list-style:none;padding-left:0;margin:0;display:flex;flex-direction:column;gap:6px}
.mtop{margin-top:14px}
.inline{display:flex;gap:6px;align-items:center}

/* PACKING / TO-DO — clean row layout */
#tab-checklist .actions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
#tab-checklist .actions input{ flex:1 1 260px; }
#checklist{ margin:0; padding:0; display:flex; flex-direction:column; gap:8px; width:100%; }
#checklist li{
  list-style:none; display:flex; align-items:center; gap:10px;
  padding:10px; border:1px solid var(--border); border-radius:10px;
  background:linear-gradient(180deg,#0c1222,#0a0e18);
}
#checklist input[type="checkbox"]{ width:18px; height:18px; margin:0; }
#checklist .item-text{ flex:1 1 auto; line-height:1.35; }
#checklist .item-text.done{ opacity:.6; text-decoration:line-through; }
#checklist .btn{ margin-left:auto; }

/* SHARED NOTES multi-note grid */
#tab-shared .actions{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px}
#tab-shared .actions input{flex:1 1 260px}
.notes-grid{display:grid; grid-template-columns:repeat( auto-fit, minmax(280px,1fr) ); gap:12px; margin-top:12px;}
.note-card{
  background:linear-gradient(180deg,#0c1222,#0a0e18);
  border:1px solid var(--border);
  border-radius:12px; padding:12px;
  display:flex; flex-direction:column; gap:8px;
}
.note-head{display:flex; align-items:center; justify-content:space-between; gap:8px}
.note-title{font-weight:700}
.note-meta{font-size:12px; color:var(--muted)}
.note-body{white-space:pre-wrap; line-height:1.45}
.note-tags{font-size:12px; color:#eab308}
.note-actions{display:flex; gap:8px; justify-content:flex-end}
